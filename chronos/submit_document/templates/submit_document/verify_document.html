{% extends 'base.html' %}
 
{% block content %}
{% load staticfiles %}
<script src="{% static 'submit_document/FileSaver.js' %}"></script>
<script src = "http://www.bichlmeier.info/sha256.js"></script>
<div class="row">
    <center>
    <center>
    <h4> Upload your token.</h4>
        <input type="file" id="files" name="files[]"/>
    </center>
    <form action="/submit" method="post" id="verify_form">
        {% csrf_token %}
      <fieldset class="form-group">
      <br>
      <center>
        <h4> Your document hash  </h4>
        <label for="text">Document Hash:</label>
        <textarea readonly class="form-control" name="text" rows="1" id = 'textarea' style="max-width:50%"></textarea>
 
        </center>
      </fieldset>
              <center><button type="submit" class="btn btn-primary"style="padding-left: 100px; padding-right: 100px">Submit</button></center>
            </form>
            <div>
                <textarea readonly hidden='true' id = 'hiddentext'></textarea>
            </div>
        </div>
    </div>
</div>  
 
 
<script>
  var MAGIC="WESTONMIZUMOTOERICBIRDSALLDENNISFANG";
  function handleFileSelect(evt) {
    var f = evt.target.files[0];
    var reader = new FileReader();

    reader.onload = (function(theFile) {
        return function(e) {
            var text = e.target.result;
            text = text.substr(MAGIC.length,text.length - 2*MAGIC.length)
            var blob = new Blob([text], {});
            saveAs(blob, "token.bpoe");
            var hash = sha256_digest(text);
            document.getElementById("textarea").innerHTML = hash;
            document.getElementById("hiddentext").innerHTML = text;
            };
        })(f);
        reader.readAsText(f);
   
    }
  $("#verify_form").submit(function(e) {
    var url = "/document_query/"; // the script where you handle the form input.

    $.ajax({
           type: "POST",
           url: url,
           data: $("#verify_form").serialize(), // serializes the form's elements.
           success: function(data)
           {
               alert(data); // show response from the php script.
           }
         });

    e.preventDefault(); // avoid to execute the actual submit of the form.
  });
  document.getElementById('files').addEventListener('change', handleFileSelect, false);
</script>
 
 
{% endblock %}